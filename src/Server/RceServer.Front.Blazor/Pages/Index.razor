@page "/"

@inject NavigationManager NavigationManager
@inject AuthService AuthService
@inject IJSRuntime JSRuntime

@if (!AuthService.UserAuthenticated)
{
	<h1>Hello, world!</h1>
	<div>Welcome to your new app.</div>
	<MasonryContainer RefreshToggle="_masonryRefreshToggle" Options=@(new { fitWidth = true })>
		@foreach (var item in _masonryList)
		{
			<MasonryItem>
				<div class="scene">
					<div class="card @(_flipped ? "is-flipped" : "")">
						<div class="card__face card__face--front" @onclick="OnClick" @onclick:stopPropagation="true" style="background-color: aliceblue;">
							<div class="masonry-test">
								<div @onclick="OnClick2" @onclick:stopPropagation="true">foo</div>
								<Collapsible Collapsed="_collapsed">
									Lorem ipsum<br />Lorem ipsum<br />Lorem ipsum<br />Lorem ipsum<br />Lorem ipsum<br />Lorem ipsum<br />Lorem ipsum<br />Lorem ipsum<br />
								</Collapsible>
							</div>
						</div>
						<div class="card__face card__face--back">
							<div @onclick="OnClick2" @onclick:stopPropagation="true">bar</div>
							back
						</div>
					</div>
				</div>
			</MasonryItem>
		}
	</MasonryContainer>
}

@code {
	private List<int> _masonryList = new List<int>();
	private List<ElementReference?> _masonryListRef = new List<ElementReference?>();
	private bool _masonryRefreshToggle;
	private bool _collapsed;
	private bool _flipped;

	protected override void OnInitialized()
	{
		if (AuthService.UserAuthenticated == false)
		{
			//NavigationManager.NavigateTo("/auth/login");
		}

		Task.Run(async () =>
		{
			for (int i = 0; i < 30; i++)
			{
				await Task.Delay(100);
				_masonryList.Add(new Random().Next(100, 300));
				_masonryListRef.Add(null);
				await InvokeAsync(StateHasChanged);
			}
		});
	}

	private async Task OnClick()
	{
		_collapsed = !_collapsed;
		_ = Task.Run(async () =>
		{
			await Task.Delay(350);
			await InvokeAsync(StateHasChanged);
			await Task.Delay(250);
			await InvokeAsync(StateHasChanged);
		});
	}

	private async Task OnClick2()
	{
		_flipped = !_flipped;
		await InvokeAsync(StateHasChanged);
	}
}
